#+TITLE: 自作OS(OS5)のまとめ
#+AUTHOR: 大神 祐真 (Ohgami Yuma)
#+LANGUAGE: ja
#+SETUPFILE: ~/git/org-html-themes/setup/theme-bigblow.setup
#+OPTIONS: ^:{}

* 成果物一覧
** 自作OS(OS5)
#+CAPTION: OS5(最新版)を実行している様子
#+ATTR_HTML: :alt OS5動作のスクリーンショット :width 640
[[file:running.gif]]

| 公開日           | FDイメージ                 | ソースコード(GitHub) | 紹介したブログ記事(はてなダイアリー)                 |
|------------------+----------------------------+----------------------+------------------------------------------------------|
| 2016/02/08(最新) | [[file:release/fd_20160208.img][fd_20160208.img(49KB)]], [[file:release/fd_20160208.img.md5][MD5]] | [[https://github.com/cupnes/os5/releases/tag/blog-20160208][tag:blog-20160208]]    | [[http://d.hatena.ne.jp/cupnes/20160208/1454943337][自作OSにファイルシステム・アプリローダを追加しました]] |
| 2015/11/30       | [[file:release/fd_20151130.img][fd_20151130.img(45KB)]], [[file:release/fd_20151130.img.md5][MD5]] | [[https://github.com/cupnes/os5/releases/tag/blog-20151130][tag:blog-20151130]]    | [[http://d.hatena.ne.jp/cupnes/20151130/1448897866][システムコールと特権管理などを追加しました]]           |
| 2015/10/31       | [[file:release/fd_20151031.img][fd_20151031.img(45KB)]], [[file:release/fd_20151031.img.md5][MD5]] | [[https://github.com/cupnes/os5/releases/tag/blog-20151031][tag:blog-20151031]]    | [[http://d.hatena.ne.jp/cupnes/20151031/1446304191][メモリ管理を追加しました]]                             |
| 2015/08/24       | [[file:release/fd_20150824.img][fd_20150824.img(36KB)]], [[file:release/fd_20150824.img.md5][MD5]] | [[https://github.com/cupnes/os5/releases/tag/blog-20150824][tag:blog-20150824]]    | [[http://d.hatena.ne.jp/cupnes/20150824/1440423038][タスク管理を追加しました]]                             |
| 2015/04/05(初)   | [[file:release/fd_20150405.img][fd_20150405.img(36KB)]], [[file:release/fd_20150405.img.md5][MD5]] | [[https://github.com/cupnes/os5/releases/tag/blog-20150405][tag:blog-20150405]]    | [[http://d.hatena.ne.jp/cupnes/20150405/1428250711][x86(32ビット)用OSを作っています]]                      |

*** 開発リポジトリ
- https://github.com/cupnes/os5

** 資料
[[http://otona-after-5.connpass.com/event/27126/][大人の放課後シリーズ#12:『【2000行弱！】x86用自作カーネルの紹介」』]] での発表資料
#+HTML: <iframe src="http://www.slideshare.net/slideshow/embed_code/key/vBMVCnIlIrTg8O" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="http//www.slideshare.net/yarakawa/2000x86" title="【2000行弱!】x86用自作カーネルの紹介" target="_blank">【2000行弱!】x86用自作カーネルの紹介</a> </strong> from <strong><a href="http://www.slideshare.net/yarakawa" target="_blank">yarakawa</a></strong> </div>

** 動作確認方法
QEMUによるx86(32bit)仮想マシンで動作確認を行っています。

*** qemu-system-i386コマンドを用いた方法
以下の様に、コマンドラインオプション"-fda"にOS5のFDイメージを指定して実行することで、OS5を起動できます。
#+BEGIN_EXAMPLE
[PC]$ qemu-system-i386 -fda fd.img
#+END_EXAMPLE

開発リポジトリ(GitHub)をclone済みであれば、cloneしたディレクトリ直下で以下のコマンドを実行することで、OS5を起動することもできます。
#+BEGIN_EXAMPLE
[PC]$ make run
#+END_EXAMPLE
※ FDイメージが生成されていなければ、自動でビルドも行われます。

*** PNaCL QEMUを用いた方法
PNaClを使用してGoogle Chromeへ移植されている[[http://neo.idletime.tokyo/web/qemu/][PNaCL QEMU]]でも動作することを確認しています。

以下の手順で、OS5をGoogle Chrome上で試してみることができます。

1. [[http://neo.idletime.tokyo/web/qemu/i386.html][PNaCL QEMUのターゲットCPU i386のページ]]へアクセス
2. 表示されるパラメータの内、「記憶装置」の「CD-ROM」のチェックを外し、「FLOPPY」にチェックを付ける(その他のパラメータはデフォルトのまま)
3. 「オプション生成」をクリック
4. OS5のFDイメージを「fda」というファイル名へリネーム
5. 「Drag & Drop」の領域へOS5のFDイメージをドラッグ&ドロップ
6. Google Chromeが動作しているホスト側のOSに合わせて、「HOST OS 32bit」あるいは「HOST OS 64bit」をクリック
7. OS5が起動

** ビルド環境(OS5BE)
32bitのDebian環境であれば、"build-essential"パッケージさえインストールされていれば、ビルド可能ですが、

現状、クロスビルドに対応していないので、64bit環境の場合はバーチャルマシンなどで32bitのDebian環境を作成するか、
以下のQEMUイメージファイルを使用してください。

| 作成日     | ディスクイメージ(qcow2)                   |
|------------+-------------------------------------------|
| 2016/01/10 | [[file:release/os5be_20160110004505.qcow2.xz][os5be_20160110004505.qcow2.xz(628MB)]], [[file:release/os5be_20160110004505.qcow2.xz.md5][MD5]] |

*** イメージファイルについて
上記のイメージファイルはDebian(Jessie 32bit)のnetinstイメージファイルを、
以下のインストール時設定でインストールし、
| ネットワークの設定               | ホスト名                           | os5be                  |
| ユーザとパスワードのセットアップ | rootのパスワード                   | root                   |
|                                  | 新しいユーザの本名(フルネーム)     | user                   |
|                                  | あなたのアカウントのユーザ名       | user                   |
|                                  | 新しいユーザのパスワード           | user                   |
| ソフトウェアの選択               | インストールするソフトウェアの選択 | すべてのチェックを外す |
※ ここで挙げていない設定項目はすべてデフォルト

以下のパッケージをインストール・設定済みの環境です。
| パッケージ名    | 備考                          |
|-----------------+-------------------------------|
| build-essential |                               |
| git             |                               |
| sshfs           |                               |
| ntp             | 同期先をntp.nict.jpで設定済み |

*** イメージファイルを使用する際には、
上記の環境はあくまでも「ビルドだけ」の環境で、Xも日本語環境もインストールされていないので、
使用の際には、以下のようにsshfsでゲストからホストのディレクトリをマウントすると使いやすいかと思います。

例) ホスト側のホームディレクトリ直下にソースコードディレクトリ"OS5"が存在する場合
#+BEGIN_EXAMPLE
[os5be]$ mkdir ~/os5
[os5be]$ sshfs ホスト側のユーザ名@10.0.2.2:os5 ~/os5
#+END_EXAMPLE
※ IPアドレス"10.0.2.2"はQEMUにてゲストからホストへアクセスする際のIPです。

** このページについて
このページはEmacsのorg-modeで作成し、[[https://github.com/fniessen/org-html-themes][org-html-themes]] のテーマを使用してHTMLへエクスポートしています。

元のorgファイルは以下で公開しています。
- https://github.com/cupnes/os5web
** 連絡先
大神 祐真 (Ohgami Yuma)

E-Mail: yuma#ohgami.jp (#を@へ変更してください)
